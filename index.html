 <!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BotMatic ‚Äì Jouw Maatwerk Chatbot</title>
  <meta name="description" content="Bouw minder, verkoop meer. BotMatic maakt chatbots die afspraken plannen, vragen beantwoorden en bestellingen aannemen. 14 dagen gratis." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --brand:#ff7a1a; --brand-600:#ff6a00;
      --ink:#0f172a; --muted:#475569; --bg:#f8fafc;
    }
    html,body{scroll-behavior:smooth}
    body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--ink)}
    .btn{display:inline-flex;align-items:center;justify-content:center;border-radius:9999px;padding:.75rem 1.25rem;font-weight:700}
    .btn-primary{background:var(--brand);color:#fff}.btn-primary:hover{background:var(--brand-600)}
    .btn-ghost{background:#0b12241a;color:var(--ink)}
    .nav-link.active{color:var(--brand)!important}
    .card{background:#fff;border-radius:1rem;box-shadow:0 8px 30px rgba(2,6,23,.06)}
    .badge{font-size:.75rem;border-radius:9999px;padding:.25rem .6rem}
    .badge-new{background:#fff;color:var(--brand);border:1px solid var(--brand)}
    .focus-ring:focus{outline:3px solid var(--brand);outline-offset:2px}
    /* Chat widget */
    #chat-container{position:fixed;bottom:6rem;right:1.5rem;width:100%;max-width:380px;height:480px;z-index:100;background:#fff;border-radius:1rem;box-shadow:0 10px 40px rgba(2,6,23,.1);display:flex;flex-direction:column;transform:translateY(20px);opacity:0;pointer-events:none;transition:all .3s}
    #chat-container.open{transform:translateY(0);opacity:1;pointer-events:auto}
    .chat-message{padding:.6rem .8rem;max-width:80%;font-size:.9rem;border-radius:1rem;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .chat-message.bot{background:#e2e8f0;border-radius:1rem 1rem 1rem 0;align-self:flex-start}
    .chat-message.user{background:var(--brand);color:#fff;border-radius:1rem 1rem 0 1rem;align-self:flex-end}
    #chat-loading{font-style:italic;color:var(--muted);align-self:flex-start;font-size:.875rem;padding-left:.75rem}
    /* Blog */
    .blog-post-card{background:#fff;padding:1.5rem;border-radius:1rem;box-shadow:0 8px 30px rgba(2,6,23,.06)}
  </style>
</head>
<body class="text-slate-800">

  <!-- Header -->
  <header class="bg-white/80 backdrop-blur sticky top-0 z-50 border-b border-slate-100">
    <nav class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between" aria-label="Hoofdmenu">
      <a href="#" class="text-2xl font-extrabold tracking-tight" onclick="showPage('home');return false;">BotMatic</a>
      <div class="hidden md:flex items-center gap-5">
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="home" onclick="showPage('home');return false;">Home</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="features" onclick="showPage('features');return false;">Functies</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="pricing" onclick="showPage('pricing');return false;">Prijzen</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="blog" onclick="showPage('blog');return false;">Blog</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="about" onclick="showPage('about');return false;">Over ons</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="testimonials" onclick="showPage('testimonials');return false;">Succesverhalen</a>
        <a href="#" class="nav-link text-slate-600 hover:text-[var(--brand)]" data-page="faq" onclick="showPage('faq');return false;">FAQ</a>
        <a href="#" class="btn btn-primary focus-ring" onclick="showPage('contact');return false;">Plan een gesprek</a>
      </div>
      <button class="md:hidden btn btn-ghost focus-ring" aria-label="Open menu" onclick="toggleMenu()">Menu</button>
    </nav>
    <div id="mobile-menu" class="md:hidden hidden border-t border-slate-200 bg-white">
      <div class="max-w-6xl mx-auto px-4 py-3 flex flex-col gap-2">
        <a href="#" class="nav-link" data-page="home" onclick="showPage('home');toggleMenu(true);return false;">Home</a>
        <a href="#" class="nav-link" data-page="features" onclick="showPage('features');toggleMenu(true);return false;">Functies</a>
        <a href="#" class="nav-link" data-page="pricing" onclick="showPage('pricing');toggleMenu(true);return false;">Prijzen</a>
        <a href="#" class="nav-link" data-page="blog" onclick="showPage('blog');toggleMenu(true);return false;">Blog</a>
        <a href="#" class="nav-link" data-page="about" onclick="showPage('about');toggleMenu(true);return false;">Over ons</a>
        <a href="#" class="nav-link" data-page="testimonials" onclick="showPage('testimonials');toggleMenu(true);return false;">Succesverhalen</a>
        <a href="#" class="nav-link" data-page="faq" onclick="showPage('faq');toggleMenu(true);return false;">FAQ</a>
        <a href="#" class="btn btn-primary mt-2" onclick="showPage('contact');toggleMenu(true);return false;">Plan een gesprek</a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10 md:py-16">
    <!-- HOME -->
    <section id="home-page" class="page-section">
      <div class="text-center py-10 md:py-16">
        <div class="inline-flex items-center gap-2 mb-4">
          <span class="badge badge-new">14 dagen gratis</span>
          <span class="text-sm text-slate-500">Geen creditcard nodig</span>
        </div>
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight">
          Laat de bot de routine doen.<br class="hidden sm:block" />Jij focust op de zaken.
        </h1>
        <p class="text-lg sm:text-xl text-slate-600 max-w-3xl mx-auto mt-4">
          BotMatic bouwt chatbots die afspraken plannen, vragen beantwoorden en bestellingen opnemen. Minder werk. Meer omzet.
        </p>
        <div class="mt-8 flex items-center justify-center gap-3">
          <a href="#" class="btn btn-primary focus-ring" onclick="showPage('contact');return false;">Vraag een vrijblijvend gesprek aan</a>
          <a href="#" class="btn btn-ghost focus-ring" onclick="showPage('features');return false;">Bekijk functies</a>
        </div>

        <div class="mt-12 grid md:grid-cols-3 gap-6">
          <div class="card p-6 text-left">
            <div class="text-3xl">‚ö°</div>
            <h3 class="font-semibold mt-2">Antwoord in seconden</h3>
            <p class="text-slate-600 text-sm mt-1">24/7 direct reactie. Geen gemiste leads ‚Äôs avonds.</p>
          </div>
          <div class="card p-6 text-left">
            <div class="text-3xl">üìÖ</div>
            <h3 class="font-semibold mt-2">Auto-planning</h3>
            <p class="text-slate-600 text-sm mt-1">Boekingen rechtstreeks in je agenda of systeem.</p>
          </div>
          <div class="card p-6 text-left">
            <div class="text-3xl">üí¨</div>
            <h3 class="font-semibold mt-2">WhatsApp-first</h3>
            <p class="text-slate-600 text-sm mt-1">Werk waar je klanten al zijn. Simpel.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section id="features-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Wat de bot voor je doet</h2>
        <p class="text-slate-600 max-w-2xl mx-auto mt-2">Concreet, duidelijk, zonder poespas.</p>
      </div>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card p-6 text-center"><span class="text-3xl">üìù</span><h3 class="text-lg font-semibold mt-2">Formulieren invullen</h3><p class="text-slate-600 text-sm mt-1">Inschrijvingen, klantdata en intake ‚Äì automatisch verzameld.</p></div>
        <div class="card p-6 text-center"><span class="text-3xl">üìÖ</span><h3 class="text-lg font-semibold mt-2">Afspraken plannen</h3><p class="text-slate-600 text-sm mt-1">Realtime beschikbaarheid. Bevestiging en herinnering erbij.</p></div>
        <div class="card p-6 text-center"><span class="text-3xl">üí°</span><h3 class="text-lg font-semibold mt-2">Vragen beantwoorden</h3><p class="text-slate-600 text-sm mt-1">FAQ direct beantwoord. Complex? Dan schakelt de bot door.</p></div>
        <div class="card p-6 text-center"><span class="text-3xl">üì¶</span><h3 class="text-lg font-semibold mt-2">Bestellingen verwerken</h3><p class="text-slate-600 text-sm mt-1">Orders aannemen en doorzetten naar je team of webshop.</p></div>
      </div>
      <div class="mt-10 card p-6">
        <h3 class="font-semibold mb-2">Werkt met</h3>
        <div class="flex flex-wrap gap-2">
          <span class="badge bg-slate-100">WhatsApp</span>
          <span class="badge bg-slate-100">Instagram</span>
          <span class="badge bg-slate-100">Telegram</span>
          <span class="badge bg-slate-100">Website-widget</span>
          <span class="badge bg-slate-100">CRM / ERP</span>
          <span class="badge bg-slate-100">Google Calendar</span>
        </div>
      </div>
    </section>

    <!-- PRICING -->
    <section id="pricing-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Kies je plan</h2>
        <p class="text-slate-600 max-w-3xl mx-auto mt-2">Elke formule start met <strong>14 dagen gratis</strong>. Stoppen kan altijd.</p>
      </div>
      <div class="grid md:grid-cols-3 gap-6 items-stretch">
        <div class="card p-6 flex flex-col">
          <div>
            <h3 class="text-2xl font-bold text-center mb-1">Instap</h3>
            <p class="text-sm text-slate-500 text-center mb-4">Voor kleine teams</p>
            <p class="text-4xl font-extrabold text-center text-[var(--brand)] mb-2">‚Ç¨29<span class="text-base text-slate-500 font-semibold"> / maand</span></p>
            <ul class="text-slate-700 text-sm space-y-2 mt-4">
              <li>‚úì 1 taak automatiseren</li><li>‚úì 1 platform</li><li>‚úì Basis support</li>
            </ul>
          </div>
          <a href="#" class="btn btn-ghost mt-6" onclick="showPage('contact');return false;">Kies Instap</a>
        </div>

        <div class="card p-6 border-2 border-[var(--brand)] relative flex flex-col">
          <span class="absolute -top-3 left-1/2 -translate-x-1/2 badge bg-[var(--brand)] text-white">Meest gekozen</span>
          <div>
            <h3 class="text-2xl font-bold text-center mb-1">Standaard</h3>
            <p class="text-sm text-slate-500 text-center mb-4">Beste waarde</p>
            <p class="text-4xl font-extrabold text-center text-[var(--brand)] mb-2">‚Ç¨99<span class="text-base text-slate-500 font-semibold"> / maand</span></p>
            <ul class="text-slate-700 text-sm space-y-2 mt-4">
              <li>‚úì Meerdere taken</li><li>‚úì 2 platforms</li><li>‚úì Prioritaire support & updates</li>
            </ul>
          </div>
          <a href="#" class="btn btn-primary mt-6" onclick="showPage('contact');return false;">Kies Standaard</a>
        </div>

        <div class="card p-6 flex flex-col">
          <div>
            <h3 class="text-2xl font-bold text-center mb-1">Premium</h3>
            <p class="text-sm text-slate-500 text-center mb-4">Voor groei & maatwerk</p>
            <p class="text-4xl font-extrabold text-center text-[var(--brand)] mb-2">‚Ç¨299<span class="text-base text-slate-500 font-semibold"> / maand</span></p>
            <ul class="text-slate-700 text-sm space-y-2 mt-4">
              <li>‚úì Maatwerk AI-flows</li><li>‚úì Koppelingen met CRM/ERP</li><li>‚úì Toegewijde projectmanager</li>
            </ul>
          </div>
          <a href="#" class="btn btn-ghost mt-6" onclick="showPage('contact');return false;">Kies Premium</a>
        </div>
      </div>
      <p class="text-center text-sm text-slate-500 mt-4">Prijzen excl. btw. Integratie- en nummerkosten kunnen vari√´ren.</p>
    </section>

    <!-- BLOG -->
    <section id="blog-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Blog</h2>
        <p class="text-slate-600 max-w-2xl mx-auto mt-2">Laatste nieuws en inzichten in automatisering.</p>
      </div>

      <!-- Generator UI (via jouw backend, geen sleutel in front) -->
      <div class="card p-6 mb-8">
        <h3 class="text-lg font-semibold mb-2">‚ú® Genereer een blogpost met AI</h3>
        <p class="text-sm text-slate-600 mb-4">Geef een onderwerp, wij schrijven via onze backend.</p>
        <div class="flex flex-col sm:flex-row gap-2">
          <input type="text" id="blog-topic-input" class="flex-grow p-2 rounded-md border border-slate-300 shadow-sm focus:border-[var(--brand)] focus:ring-[var(--brand)] text-sm" placeholder="Voer hier een onderwerp in...">
          <button id="generate-blog-btn" class="btn btn-primary focus-ring">Genereer post</button>
        </div>
        <div id="blog-loading" class="mt-4 text-center text-slate-500 hidden">De AI schrijft... een momentje</div>
      </div>

      <div id="blog-posts-container" class="grid md:grid-cols-2 gap-6"></div>
    </section>

    <!-- ABOUT -->
    <section id="about-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Over ons</h2>
        <p class="text-slate-600 max-w-3xl mx-auto mt-2">BotMatic is een Belgisch team dat no-nonsense chatbots bouwt. Snel live, helder in prijs, en gericht op resultaat.</p>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="card p-6 border-l-4 border-[var(--brand)]">
          <h3 class="text-xl font-semibold mb-2">Onafhankelijk</h3>
          <p class="text-slate-600">We zijn geen onderdeel van gelijknamige bedrijven in de VS of India. Eigen team, eigen standaard.</p>
        </div>
        <div class="card p-6">
          <h3 class="text-xl font-semibold mb-2">GDPR-proof</h3>
          <p class="text-slate-600">Privacy eerst. Duidelijke datastromen en bewaartermijnen. Jij blijft eigenaar van de data.</p>
        </div>
      </div>
    </section>

    <!-- TESTIMONIALS -->
    <section id="testimonials-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Succesverhalen</h2>
        <p class="text-slate-600 max-w-2xl mx-auto mt-2">Echte tijdswinst. Echte omzet.</p>
      </div>
      <div class="grid md:grid-cols-2 gap-6">
        <div class="card p-6"><p class="italic mb-3">‚ÄúOnze planningstijd daalde met 70%. Team blij, klanten blij.‚Äù</p><p class="font-semibold text-right">‚Äî Pieter G., Tandartspraktijk</p></div>
        <div class="card p-6"><p class="italic mb-3">‚ÄúWhatsApp-vragen worden automatisch afgehandeld. Support werkt nu aan de moeilijke cases.‚Äù</p><p class="font-semibold text-right">‚Äî Sarah V., E-commerce</p></div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact-page" class="page-section hidden">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold">Neem contact op</h2>
        <p class="text-slate-600 max-w-2xl mx-auto mt-2">Vertel kort wat je wil automatiseren. We denken mee.</p>
      </div>
      <div class="card p-8 max-w-xl mx-auto">
        <form id="contact-form" class="space-y-5" novalidate>
          <div><label for="name" class="block text-sm font-medium">Naam</label><input id="name" name="name" type="text" class="mt-1 w-full rounded-md border-slate-300 shadow-sm focus:border-[var(--brand)] focus:ring-[var(--brand)] p-2" required></div>
          <div><label for="email" class="block text-sm font-medium">E-mail</label><input id="email" name="email" type="email" class="mt-1 w-full rounded-md border-slate-300 shadow-sm focus:border-[var(--brand)] focus:ring-[var(--brand)] p-2" required></div>
          <div><label for="message" class="block text-sm font-medium">Wat wil je automatiseren?</label><textarea id="message" name="message" rows="4" class="mt-1 w-full rounded-md border-slate-300 shadow-sm focus:border-[var(--brand)] focus:ring-[var(--brand)] p-2" required></textarea></div>
          <input type="text" id="company" name="company" class="hidden" tabindex="-1" autocomplete="off" aria-hidden="true">
          <div class="flex items-center gap-2 text-sm"><input id="consent" type="checkbox" class="rounded border-slate-300 text-[var(--brand)] focus:ring-[var(--brand)]" required><label for="consent">Ik ga akkoord met het verwerken van mijn gegevens om contact op te nemen.</label></div>
          <div id="form-success-message" class="hidden text-green-700 bg-green-100 p-3 rounded-md text-center">Bedankt! Je aanvraag is verzonden. We nemen snel contact op.</div>
          <button id="submit-btn" type="submit" class="btn btn-primary w-full">Verstuur</button>
        </form>
        <div class="mt-6 text-center text-sm text-slate-600">Liever direct? <a href="https://wa.me/0000000000" class="text-[var(--brand)] font-semibold hover:underline">WhatsApp ons</a> of bel <a href="tel:+32000000000" class="hover:underline">+32 000 00 00 00</a>.</div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-slate-900 text-slate-300 py-8 mt-12">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center space-y-2">
      <p class="text-sm">¬© <span id="year"></span> BotMatic. Alle rechten voorbehouden.</p>
      <p class="text-xs text-slate-400">Made in Belgium ¬∑ GDPR-proof</p>
    </div>
  </footer>

  <!-- Live Chat Widget -->
  <div id="chat-widget" class="fixed bottom-4 right-4 md:bottom-8 md:right-8 z-50">
    <button id="chat-toggle-btn" class="bg-[var(--brand)] text-white p-4 rounded-full shadow-lg hover:bg-[var(--brand-600)] transition-colors focus:outline-none focus:ring-4 focus:ring-[var(--brand)] focus:ring-opacity-50" aria-label="Open chat">
      <!-- icon -->üí¨
    </button>
  </div>
  <div id="chat-container" class="md:right-8" aria-live="polite">
    <div class="p-4 bg-[var(--brand)] text-white flex justify-between items-center rounded-t-lg">
      <h3 class="font-bold">BotMatic Chat</h3>
      <button id="chat-close-btn" class="p-1 rounded-full hover:bg-white/20 transition-colors" aria-label="Sluit chat">‚úï</button>
    </div>
    <div id="chat-messages" class="flex-grow p-4 overflow-y-auto space-y-3"></div>
    <div class="p-4 border-t border-slate-200">
      <form id="chat-form" class="flex gap-2">
        <input type="text" id="chat-input" class="flex-grow p-2 rounded-full border border-slate-300 focus:border-[var(--brand)] focus:ring-[var(--brand)] text-sm" placeholder="Typ je bericht..." autocomplete="off">
        <button type="submit" id="chat-send-btn" class="btn btn-primary p-2 w-10 h-10 rounded-full" aria-label="Stuur">‚û§</button>
      </form>
      <div id="chat-loading" class="mt-2 hidden">BotMatic typt...</div>
    </div>
  </div>

  <script type="module">
    // ---------- Firebase (front only voor data; GEEN AI-sleutels in front) ----------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, collection, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Deze globals vul je via je bundler of inlined script voor deploy:
    // window.__app_id, window.__firebase_config
    const appId = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';
    const firebaseConfig = typeof window.__firebase_config !== 'undefined' ? window.__firebase_config : null;

    let app=null, auth=null, db=null, authed=false;

    if (firebaseConfig && Object.keys(firebaseConfig).length) {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      onAuthStateChanged(auth, (user) => {
        authed = !!user;
        if (!user) signInAnonymously(auth).catch(console.error);
        if (user) startApp(user.uid);
      });
    } else {
      console.warn("Firebase config ontbreekt. Firestore functionaliteit uitgeschakeld.");
    }

    // ---------- SPA nav ----------
    const pages = document.querySelectorAll('.page-section');
    const navLinks = document.querySelectorAll('.nav-link');
    function setActive(pageId){
      navLinks.forEach(l=>{
        const isActive = l.getAttribute('data-page') === pageId;
        l.classList.toggle('active', isActive);
        if(isActive){ l.setAttribute('aria-current','page'); } else { l.removeAttribute('aria-current'); }
      });
    }
    function showPage(pageId){
      pages.forEach(p=>p.classList.add('hidden'));
      const el = document.getElementById(`${pageId}-page`);
      if(el) el.classList.remove('hidden');
      setActive(pageId);
      history.replaceState(null,'',`#${pageId}`);
    }
    function toggleMenu(forceClose=false){
      const m=document.getElementById('mobile-menu');
      if(forceClose){ m.classList.add('hidden'); return; }
      m.classList.toggle('hidden');
    }

    // ---------- Contact form (opslaan in Firestore; mailen via backend) ----------
    const form = document.getElementById('contact-form');
    const submitBtn = document.getElementById('submit-btn');
    const successMsg = document.getElementById('form-success-message');

    if(form){
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const hp = document.getElementById('company').value; // honeypot
        if(hp) return;
        if(!form.reportValidity()) return;

        submitBtn.textContent='Bezig met versturen...';
        submitBtn.disabled=true;

        const payload = {
          name: document.getElementById('name').value.trim(),
          email: document.getElementById('email').value.trim(),
          message: document.getElementById('message').value.trim(),
          timestamp: (db ? serverTimestamp() : new Date().toISOString())
        };

        try{
          if(db){
            await addDoc(collection(db, `/artifacts/${appId}/public/data/contacts`), payload);
          }
          // daarnaast naar je backend sturen (mail/slack/etc.)
          fetch('/api/contact', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)}).catch(()=>{});
          form.classList.add('hidden');
          successMsg.classList.remove('hidden');
          form.reset();
        }catch(err){
          console.error(err);
          alert('Er ging iets mis. Probeer later opnieuw.');
        }finally{
          submitBtn.textContent='Verstuur';
          submitBtn.disabled=false;
        }
      });
    }

    // ---------- Live Chat (front ‚Üí backend proxy) ----------
    const chatToggleBtn = document.getElementById('chat-toggle-btn');
    const chatCloseBtn = document.getElementById('chat-close-btn');
    const chatContainer = document.getElementById('chat-container');
    const chatMessages = document.getElementById('chat-messages');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send-btn');
    const chatLoading = document.getElementById('chat-loading');
    let lastSentAt = 0;

    function addMessage(text, role){
      const div=document.createElement('div');
      div.className=`chat-message ${role}`;
      div.textContent=text;
      chatMessages.appendChild(div);
      chatMessages.scrollTop=chatMessages.scrollHeight;
    }

    chatToggleBtn.addEventListener('click', ()=> chatContainer.classList.toggle('open'));
    chatCloseBtn.addEventListener('click', ()=> chatContainer.classList.remove('open'));

    if(chatForm){
      chatForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const now=Date.now();
        if(now-lastSentAt<1200) return; // –ø—Ä–æ—Å—Ç–µ–π—à–∏–π rate-limit
        const text = chatInput.value.trim();
        if(!text) return;

        addMessage(text,'user');
        chatInput.value='';
        lastSentAt=now;
        chatInput.disabled=true; chatSendBtn.disabled=true; chatLoading.classList.remove('hidden');

        try{
          // –í–°–ï –ò–ò-–∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–∞ —Ç–≤–æ–π –ë–ï–ö–ï–ù–î (–æ–Ω —É–∂–µ –¥–µ—Ä–≥–∞–µ—Ç Gemini/OpenAI –∏ –ø—Ä—è—á–µ—Ç –∫–ª—é—á–∏)
          const r = await fetch('/api/ai/chat', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ appId, text })});
          const data = await r.json();
          addMessage((data && data.reply) ? data.reply : 'Geen antwoord ontvangen.', 'bot');
        }catch(err){
          console.error(err);
          addMessage('Er is een fout opgetreden. Probeer later opnieuw.', 'bot');
        }finally{
          chatInput.disabled=false; chatSendBtn.disabled=false; chatLoading.classList.add('hidden'); chatInput.focus();
        }
      });
    }

    // ---------- Blog (list + generate via backend) ----------
    const blogContainer = document.getElementById('blog-posts-container');
    const generateBlogBtn = document.getElementById('generate-blog-btn');
    const blogTopicInput = document.getElementById('blog-topic-input');
    const blogLoading = document.getElementById('blog-loading');

    function sanitizeBasic(html){
      // –ü—Ä–æ—Å—Ç–∞—è –∑–∞—â–∏—Ç–∞: —É–¥–∞–ª—è–µ–º <script>, on* handlers, iframe; —Ä–∞–∑—Ä–µ—à–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ç–µ–≥–∏
      const tmp=document.createElement('div'); tmp.innerHTML=html||'';
      const scripts=tmp.querySelectorAll('script,iframe,object,embed');
      scripts.forEach(n=>n.remove());
      tmp.querySelectorAll('*').forEach(el=>{
        [...el.attributes].forEach(a=>{
          const n=a.name.toLowerCase();
          if(n.startsWith('on') || n==='style') el.removeAttribute(a.name);
        });
      });
      return tmp.innerHTML;
    }

    function renderBlogPosts(posts){
      if(!blogContainer) return;
      blogContainer.innerHTML='';
      posts.forEach(post=>{
        const date = post.timestamp && post.timestamp.seconds
          ? new Date(post.timestamp.seconds*1000)
          : (post.timestamp ? new Date(post.timestamp) : new Date());
        const d = date.toLocaleDateString('nl-NL',{day:'numeric',month:'long',year:'numeric'});
        const card=document.createElement('div');
        card.className='blog-post-card';
        card.innerHTML=`
          <p class="text-sm text-slate-500 mb-1">${d}</p>
          <h3 class="font-semibold text-xl mb-2"></h3>
          <div class="prose prose-slate max-w-none text-[15px] leading-7"></div>
        `;
        card.querySelector('h3').textContent = post.titel || 'Zonder titel';
        card.querySelector('.prose').innerHTML = sanitizeBasic(post.inhoud || '');
        blogContainer.appendChild(card);
      });
    }

    async function fetchBlogFromBackend(){
      try{
        const r = await fetch(`/api/blog?appId=${encodeURIComponent(appId)}`);
        if(r.ok){
          const posts=await r.json();
          renderBlogPosts(Array.isArray(posts)?posts:[]);
        }
      }catch(e){ console.warn('Blog fetch failed',e); }
    }

    if(generateBlogBtn){
      generateBlogBtn.addEventListener('click', async ()=>{
        const topic = (blogTopicInput.value||'').trim();
        if(!topic){ blogTopicInput.focus(); return; }
        generateBlogBtn.disabled=true; generateBlogBtn.textContent='Genereren...'; blogLoading.classList.remove('hidden');
        try{
          const r = await fetch('/api/ai/blog', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ appId, topic })});
          if(!r.ok){ throw new Error('API fout'); }
          // backend zelf schrijft in Firestore/DB; –º—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º —Å–ø–∏—Å–æ–∫
          await new Promise(res=>setTimeout(res,400));
          if(db){ /* wachten op snapshot */ } else { await fetchBlogFromBackend(); }
          blogTopicInput.value='';
        }catch(err){
          console.error(err); alert('Kon geen blogpost genereren. Probeer opnieuw.');
        }finally{
          generateBlogBtn.disabled=false; generateBlogBtn.textContent='Genereer post'; blogLoading.classList.add('hidden');
        }
      });
    }

    // ---------- Firestore listeners ----------
    function startApp(uid){
      // Chat history (laatste 50, op tijd)
      if(db){
        const chatQ = query(collection(db, `/artifacts/${appId}/public/data/chat-history`), orderBy('timestamp','asc'), limit(50));
        onSnapshot(chatQ, snap=>{
          // render simpel: wis en –ø–µ—Ä–µ—Ä–∏—Å—É–π (—á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å)
          chatMessages.innerHTML='';
          snap.forEach(docSnap=>{
            const d=docSnap.data();
            addMessage(d.text||'', d.role==='user'?'user':'bot');
          });
        });
        // Blog posts live
        const blogQ = query(collection(db, `/artifacts/${appId}/public/data/blog-posts`), orderBy('timestamp','desc'), limit(20));
        onSnapshot(blogQ, snap=>{
          const posts=snap.docs.map(d=>d.data());
          renderBlogPosts(posts);
        });
        // Welkomst–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π)
        setTimeout(async ()=>{
          if(chatMessages.children.length===0){
            addMessage('Hallo! Welkom bij BotMatic. Hoe kan ik je vandaag helpen?','bot');
          }
        },600);
      } else {
        // Fallback zonder Firestore
        fetchBlogFromBackend();
      }
    }

    // ---------- Init ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      const hash=(location.hash||'#home').replace('#',''); showPage(hash);
      document.getElementById('year').textContent=new Date().getFullYear();
    });
  </script>

  <script>
    // Kleine helpers die niet in module –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å
    function toggleAnswer(btn){
      const answer = btn.nextElementSibling;
      const icon = btn.querySelector('span:last-child');
      const open = answer && answer.classList.contains('hidden');
      if(!answer) return;
      answer.classList.toggle('hidden');
      if(icon) icon.textContent = open ? '‚Äì' : '+';
    }
  </script>
</body>
</html>
